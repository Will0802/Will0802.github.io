<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      i {
        font-size: 48px;
      }
      [box-id] {
        /* width: 80px; */
        height: 80px;
        display: flex;
        justify-content: center;
        align-items: center;
        border: none;
        transition: 0.3s;
      }

      [box-id].active {
        border: dashed 2px blue;
        box-shadow: 0 0 10px blue;
        transition: 0.1s;
      }

      #msg {
        font-size: 36px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container m-auto py-3">
      <div class="row">
        <div box-id="1" class="col-1"></div>
        <div box-id="2" class="col-1"></div>
        <div box-id="3" class="col-1"></div>
        <div box-id="4" class="col-1"></div>
        <div box-id="5" class="col-1"></div>
        <div box-id="6" class="col-1"></div>
        <div box-id="7" class="col-1"></div>
        <div box-id="8" class="col-1"></div>
        <div box-id="9" class="col-1"></div>
        <div box-id="10" class="col-1"></div>
        <div box-id="11" class="col-1"></div>
        <div box-id="12" class="col-1"></div>
      </div>
      <div class="row">
        <div box-id="32" class="col-1"></div>
        <div class="col-10"></div>
        <div box-id="13" class="col-1"></div>
      </div>
      <div class="row">
        <div box-id="31" class="col-1"></div>
        <div class="col-10"><p id="msg"></p></div>
        <div box-id="14" class="col-1"></div>
      </div>
      <div class="row">
        <div box-id="30" class="col-1"></div>
        <div class="col-10 text-center">
          <button class="button">Start</button>
        </div>
        <div box-id="15" class="col-1"></div>
      </div>
      <div class="row">
        <div box-id="29" class="col-1"></div>
        <div class="col-10"></div>
        <div box-id="16" class="col-1"></div>
      </div>
      <div class="row">
        <div box-id="28" class="col-1"></div>
        <div box-id="27" class="col-1"></div>
        <div box-id="26" class="col-1"></div>
        <div box-id="25" class="col-1"></div>
        <div box-id="24" class="col-1"></div>
        <div box-id="23" class="col-1"></div>
        <div box-id="22" class="col-1"></div>
        <div box-id="21" class="col-1"></div>
        <div box-id="20" class="col-1"></div>
        <div box-id="19" class="col-1"></div>
        <div box-id="18" class="col-1"></div>
        <div box-id="17" class="col-1"></div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>

    <script>
      const brickData = [
        {
          id: "1",
          color: "blue",
          icon: "fa-solid fa-paw",
          target: function () {
            return "paw";
          },
        },
        {
          id: "2",
          color: "blue",
          icon: "fa-solid fa-paw",
          target: function () {
            return "paw";
          },
        },
        {
          id: "3",
          color: "blue",
          icon: "fa-solid fa-dog",
          target: function () {
            return "dog";
          },
        },
        {
          id: "4",
          color: "blue",
          icon: "fa-solid fa-dog",
          target: function () {
            return "dog";
          },
        },
        {
          id: "5",
          color: "blue",
          icon: "fa-solid fa-fish",
          target: function () {
            return "fish";
          },
        },
        {
          id: "6",
          color: "blue",
          icon: "fa-solid fa-fish",
          target: function () {
            return "fish";
          },
        },
        {
          id: "7",
          color: "blue",
          icon: "fa-solid fa-otter",
          target: function () {
            return "otter";
          },
        },
        {
          id: "8",
          color: "blue",
          icon: "fa-solid fa-otter",
          target: function () {
            return "otter";
          },
        },
        {
          id: "9",
          color: "blue",
          icon: "fa-solid fa-cat",
          target: function () {
            return "cat";
          },
        },
        {
          id: "10",
          color: "blue",
          icon: "fa-solid fa-cat",
          target: function () {
            return "cat";
          },
        },
        {
          id: "11",
          color: "blue",
          icon: "fa-solid fa-cow",
          target: function () {
            return "cow";
          },
        },
        {
          id: "12",
          color: "blue",
          icon: "fa-solid fa-cow",
          target: function () {
            return "cow";
          },
        },
        {
          id: "13",
          color: "blue",
          icon: "fa-solid fa-frog",
          target: function () {
            return "frog";
          },
        },
        {
          id: "14",
          color: "blue",
          icon: "fa-solid fa-frog",
          target: function () {
            return "frog";
          },
        },
        {
          id: "15",
          color: "blue",
          icon: "fa-solid fa-spider",
          target: function () {
            return "spider";
          },
        },
        {
          id: "16",
          color: "blue",
          icon: "fa-solid fa-spider",
          target: function () {
            return "spider";
          },
        },
        {
          id: "17",
          color: "blue",
          icon: "fa-solid fa-dove",
          target: function () {
            return "dove";
          },
        },
        {
          id: "18",
          color: "blue",
          icon: "fa-solid fa-dove",
          target: function () {
            return "dove";
          },
        },
        {
          id: "19",
          color: "blue",
          icon: "fa-solid fa-crow",
          target: function () {
            return "crow";
          },
        },
        {
          id: "20",
          color: "blue",
          icon: "fa-solid fa-crow",
          target: function () {
            return "crow";
          },
        },
        {
          id: "21",
          color: "blue",
          icon: "fa-solid fa-hippo",
          target: function () {
            return "hippo";
          },
        },
        {
          id: "22",
          color: "blue",
          icon: "fa-solid fa-hippo",
          target: function () {
            return "hippo";
          },
        },
        {
          id: "23",
          color: "blue",
          icon: "fa-solid fa-worm",
          target: function () {
            return "worm";
          },
        },
        {
          id: "24",
          color: "blue",
          icon: "fa-solid fa-worm",
          target: function () {
            return "worm";
          },
        },
        {
          id: "25",
          color: "blue",
          icon: "fa-solid fa-kiwi-bird",
          target: function () {
            return "kiwi-bird";
          },
        },
        {
          id: "26",
          color: "blue",
          icon: "fa-solid fa-kiwi-bird",
          target: function () {
            return "kiwi-bird";
          },
        },
        {
          id: "27",
          color: "blue",
          icon: "fa-solid fa-horse",
          target: function () {
            return "horse";
          },
        },
        {
          id: "28",
          color: "blue",
          icon: "fa-solid fa-horse",
          target: function () {
            return "horse";
          },
        },
        {
          id: "29",
          color: "blue",
          icon: "fa-solid fa-bugs",
          target: function () {
            return "bugs";
          },
        },
        {
          id: "30",
          color: "blue",
          icon: "fa-solid fa-bugs",
          target: function () {
            return "bugs";
          },
        },
        {
          id: "31",
          color: "blue",
          icon: "fa-solid fa-dragon",
          target: function () {
            return "dragon";
          },
        },
        {
          id: "32",
          color: "blue",
          icon: "fa-solid fa-dragon",
          target: function () {
            return "dragon";
          },
        },
      ];
      //宣告
      let steps = 0; //剩餘的步數
      let allSteps = 0; //全部的步數
      let currentIndex = 0; //目前走到哪一格
      let speed; // 速率(越大代表越慢),給setTimeout當作時間參數

      let bricks = document.querySelectorAll("[box-id]"); //NodeList(32)[]
      bricks = Array.from(bricks).sort((a, b) => {
        //把抓到的box DOM物件 依照box-id排序
        return (
          a.getAttributeNode("box-id").value -
          b.getAttributeNode("box-id").value
        );
      });
      console.log(bricks); // (32)[]  從NodeList轉Array
      bricks.forEach((x, index) => {
        let id = index + 1;
        let data = brickData.find((x) => x.id == id); // {"id": "1", "color": "blue", "icon": "fab fa-facebook-square"}
        // console.log(data);
        let icon = document.createElement("i");
        icon.setAttribute("class", data.icon);
        icon.style.color = data.color;
        x.appendChild(icon);
      });

      document.querySelector("button").addEventListener("click", () => {
        speed = 30;
        let random = Math.floor(Math.random() * brickData.length) + 1; //brickData.length=32,Math.random()生成0~1(包含 0，不包含 1)之間隨機浮點數
        steps = random + 3 * bricks.length; // 0~32之間的隨機數加上 3*32
        allSteps = steps;
        console.log(allSteps);
        turnAround();
      });

      function turnAround() {
        bricks[currentIndex].classList.remove("active");
        currentIndex++;

        if (currentIndex >= bricks.length) {
          currentIndex = 0;
        }
        bricks[currentIndex].classList.add("active");
        steps--;

        //一般版本
        // if (steps > 0) {
        //   setTimeout(turnAround, speed);
        // } else {
        //   //跑完了
        //   let msgBox = document.getElementById("msg");
        //   let val = brickData[currentIndex].target();
        //   msgBox.innerText = `${val}`;
        // }

        //變速版本
        if (steps > 0) {
          setTimeout(turnAround, speed);

          //當剩下1/3時，減速度
          if (steps < Math.floor(allSteps / 3)) {
            speed += 5;
          }
        } else {
          //跑完了
          let msgBox = document.getElementById("msg");
          let val = brickData[currentIndex].target(); //設計的資料內取得 return 'XXXX'
          console.log(brickData[currentIndex]);
          msgBox.innerText = `${val}`;
        }
      }
    </script>
  </body>
</html>
